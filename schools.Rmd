---
title: "Covid19 Situation in Outaouais Schools"
output:
  html_document:
    theme: darkly
    toc: true
    toc_depth: 1
    includes:
      before_body: translate.html
params: 
  optimize: false
---

```{r setup, include=FALSE}
library(tidyverse)
library(lubridate)
knitr::knit_hooks$set(optipng = knitr::hook_optipng)
knitr::knit_hooks$set(pngquant = knitr::hook_pngquant)
knitr::opts_chunk$set(echo = FALSE, cache = FALSE, results = 'hide', warning = FALSE, message = FALSE)
knitr::opts_chunk$set(dpi = 120, fig.width = 7, fig.height = 5, out.width = "100%", out.height = "100%")
if(params$optimize) knitr::opts_chunk$set(optipng = '-o7')
Sys.setlocale(category = "LC_ALL", locale = "en_CA.UTF-8")
load("data/municipalities.RData")
pop_outaouais_2020 <- 401388
load("data/schools.RData")
# tapply(schools$school, schools$admin, function(x) length(unique(x)))
# table(schools[, c("note", "color_code")])
# unique(schools$school)
schools$school <- str_replace(schools$school, 
  "École Cité Étudiante de la Haute-Gatineau", 
  "École Cité Étudiante\nde la Haute-Gatineau")
schools$school <- str_replace(schools$school, 
  "École Cœur de la Gatineau, pavillon St-Nom-de-Marie", 
  "École Cœur de la Gatineau, pavillon St-Nom-de-Marie")
schools$school <- str_replace(schools$school, 
  "Centre d'éducation des Adultes, programme FIS maison amitié de Maniwaki", 
  "Centre d'éducation des Adultes,\nprogramme FIS maison\namitié de Maniwaki")
schools$school <- str_replace(schools$school, "École", "É.")
schools$school <- str_replace(schools$school, "école", "É.")
schools$school <- str_replace(schools$school, "School", "S.")
schools$school <- str_replace(schools$school, "Shcool", "S.")
schools$school <- str_replace(schools$school, "Education", "Ed.")
schools$school <- str_replace(schools$school, "Centre de formation professionnelle des métiers", "CFP")
schools$school <- str_replace(schools$school, "Centre de formation professionnelle", "CFP")
schools$school <- str_replace(schools$school, "Centre", "C.")
schools$school <- str_replace(schools$school, " de l'Outaouais", "\nde l'Outaouais")
schools$school <- str_replace(schools$school, "Collège ", "Collège\n")
schools$school <- str_replace(schools$school, ", pavillon ", ", ")
schools$school[schools$admin == "Centre de services scolaire des Hauts-Bois-de-l'Outaouais"] <- 
    str_replace(schools$school[schools$admin == "Centre de services scolaire des Hauts-Bois-de-l'Outaouais"], fixed(", "), ",\n")
schools$school <- str_replace(schools$school, fixed(" ("), "\n(")
schools$school <- str_trim(schools$school)
# unique(schools$school[str_detect(schools$school, "blah")])
```

**Please note the caveats at the bottom of this page.**

<!-- - [Schools](schools.html) -->

```{r figure_functions}
common_theme <- theme_classic() +
  theme(axis.text.x = element_text(angle = 15, vjust = 1.0, hjust = 1.0),
        axis.title = element_blank(),
        legend.position = "top",
        legend.title = element_blank(),
        legend.text = element_text(size = rel(0.67)),
        legend.margin = margin(0, 0, 0, 0),
        # legend.box.margin = margin(-10, -10, -10, -10),
        panel.grid.minor.x = element_line(colour="lightgray", size = 0.25),
        # plot.margin = unit(c(5, 5, 5, 5), "pt"),
        plot.caption = element_text(size = rel(0.67)))
SchoolsFig <- function(admin) {
  ggplot(data = schools[schools$admin %in% admin, ],
         aes(x = time, y = school)) +
    geom_point(mapping = aes(x = time, y = school, group = note, colour = note), size = 0.75) +
    # geom_segment(mapping = aes(x = time, xend = lead(time), y = school, yend = school, group = note, colour = note)) +
    scale_color_manual(values = c("newly listed" = "darkgreen",
                                  "previously listed" = "darkgray",
                                  "reaffected previously listed" = "red",
                                  "relisted newly affected" = "green"),
                       breaks = c("newly listed", "previously listed", "reaffected previously listed", "relisted newly affected")
    ) + 
    scale_x_datetime(date_breaks = "2 weeks", date_labels = "%d %b %Y") +
    guides(colour = guide_legend(ncol = 4)) + 
    labs(x = "", y = "") + common_theme  
}
```

# Schools with cases by Outaouais School Board {.tabset .tabset-fade .tabset-pills}

## CSS des Draveurs
```{r draveurs}
SchoolsFig(c("Centre de services scolaire des Draveurs"))
```

## CSS des Portages-de-l'Outaouais
```{r portages}
SchoolsFig(c("Centre de services scolaire des Portages-de-l'Outaouais"))
```

## Western Québec School Board
```{r anglo}
SchoolsFig(c("Commission scolaire Western Québec"))
```

## CSS au Cœur-des-Vallées
```{r vallees}
SchoolsFig(c("Centre de services scolaire au Cœur-des-Vallées"))
```

## CSS des Hauts-Bois-de-l'Outaouais
```{r hauts_bois}
SchoolsFig(c("Centre de services scolaire des Hauts-Bois-de-l'Outaouais"))
```

## École privée
```{r privee}
SchoolsFig(c("École privée"))
```

# Information on this site {.tabset .tabset-pills}

## Method & Caveats

The HTML source for the [CISSS Outaouais site](https://cisss-outaouais.gouv.qc.ca/language/en/covid19-en/) is accessed daily, the tables are scraped and processed into a tidy dataset, to produce the local figures on this site. 
For the regional and RLS levels, various official datasets are downloaded daily from Quebec government and INSPQ sites. 
Some historical hospitalization data come from the [Ministère de la Santé et des Services sociaux (MSSS)](https://www.donneesquebec.ca/recherche/dataset/covid-19-portrait-quotidien-des-hospitalisations).
The latest [opencovid.ca](https://opencovid.ca/) health region data are included for comparison. 
The source code for downloading and processing all data, and the resulting datasets, are available in the project [GitHub repository](https://github.com/timothoms/covid19Outaouais). 
Daily automation is currently done with MacScheduler.

Users of these data need to be aware of the following caveats:

1. ...

Updates of this page usually occur after 5pm. 
If the figures do not show the latest data, reload this page in your web browser.

Last data update: `r str_replace(read_file("data/data_update_time.txt"), "\n", "")`

Last page update: `r now()`

## Glossary 

| Indicators                 | Description                                                                                          |
|----------------------------|------------------------------------------------------------------------------------------------------|
| Active cases               | total number minus numbers of deaths and resolved cases, aggregated at regional or RLS level         |
| Average increase per day   | average daily increase in cases over last 7 days, calculated from available data                     |
| Average testing per day    | reported average daily number of covid-19 tests performed over last 6-7 days                         |
| Hospitalizations (non-ICU) | reported active hospitalizations (excluding ICU) for confirmed covid-19 diagnosis                    |
| Hospitalizations (ICU)     | reported active hospitalizations (in ICU) for confirmed covid-19 diagnosis                           |
| Resolved/recovered cases   | reported number of resolved cases at regional level                                                  |
| Total cases                | reported total number of cases of infections to date, aggregated at regional, RLS or municipal level |
| Total deaths               | reported total number of deaths at the regional level                                                |
| Vaccination                | Vaccine doses administered in the region (may not be Outaouais residents)                            |

## Disclaimer

Please read this disclaimer ("disclaimer") carefully before using this website (the “Site”). All information provided on the Site is merely for general informational and educational purposes. It does not contain, and is not a substitute for, professional advice. 

Under no circumstance shall I have any liability to you for any loss or damage of any kind incurred as a result of the use of the site or reliance on any information provided on the site. Your use of the site and your reliance on any information on the site is solely at your own risk. 

While the information on the Site has been verified to the best of my abilities, I cannot guarantee that there are no mistakes or errors. All information on the Site is provided in good faith, however I make no representation or warranty of any kind, express or implied, regarding the accuracy, adequacy, validity, reliability, availability or completeness of any information on the Site.

I reserve the right to change this policy at any given time, in which case this disclaimer will be updated.

# {.unlisted .unnumbered}

\ 

This page is maintained by Timo Thoms. 
Questions, concerns, and suggestions can be raised through [GitHub Discussions](https://github.com/timothoms/covid19Outaouais/discussions).
